// ğŸ‘ï¸ **ã‚«ãƒ©ãƒ¼ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ãƒã‚¹ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**\n\n'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { Eye, EyeOff, AlertTriangle, CheckCircle, Info, RefreshCw } from 'lucide-react';\nimport { ColorInfo } from '../types/color';\nimport { ColorBlindnessResult } from '../types/advanced';\nimport { simulateColorBlindness } from '../utils/advancedColorUtils';\n\ninterface ColorBlindnessTestProps {\n  colors: ColorInfo[];\n  onResultsChange: (results: ColorBlindnessResult) => void;\n  showSimulation?: boolean;\n}\n\n/**\n * ğŸ‘ï¸ **ã‚«ãƒ©ãƒ¼ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ãƒã‚¹ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**\n * \n * è‰²è¦šå¤šæ§˜æ€§ï¼ˆè‰²ç›²ãƒ»è‰²å¼±ï¼‰ã«é…æ…®ã—ãŸãƒ‡ã‚¶ã‚¤ãƒ³ã®ãŸã‚ã®\n * ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è©•ä¾¡ã‚’æä¾›ã—ã¾ã™\n * \n * @example\n * <ColorBlindnessTest \n *   colors={paletteColors}\n *   onResultsChange={handleColorBlindnessResults}\n *   showSimulation={true}\n * />\n */\nexport default function ColorBlindnessTest({\n  colors,\n  onResultsChange,\n  showSimulation = true\n}: ColorBlindnessTestProps) {\n  const [results, setResults] = useState<ColorBlindnessResult | null>(null);\n  const [activeView, setActiveView] = useState<'original' | 'protanomaly' | 'deuteranomaly' | 'tritanomaly' | 'monochromacy'>('original');\n  const [isLoading, setIsLoading] = useState(false);\n  const [showDetails, setShowDetails] = useState(false);\n\n  // ğŸ§® **è‰²è¦šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ**\n  useEffect(() => {\n    if (colors.length === 0) {\n      setResults(null);\n      return;\n    }\n\n    setIsLoading(true);\n    \n    // éåŒæœŸã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼ˆé‡ã„å‡¦ç†ã®ãŸã‚ï¼‰\n    const runSimulation = async () => {\n      await new Promise(resolve => setTimeout(resolve, 100)); // UIæ›´æ–°ã®ãŸã‚ã®çŸ­ã„å¾…æ©Ÿ\n      \n      const simulationResults = simulateColorBlindness(colors);\n      setResults(simulationResults);\n      onResultsChange(simulationResults);\n      setIsLoading(false);\n    };\n\n    runSimulation();\n  }, [colors, onResultsChange]);\n\n  // ğŸ¨ **è‰²è¦šã‚¿ã‚¤ãƒ—ã®æƒ…å ±**\n  const visionTypes = {\n    original: {\n      name: 'ã‚ªãƒªã‚¸ãƒŠãƒ«',\n      description: 'ä¸€èˆ¬çš„ãªè‰²è¦šï¼ˆ3è‰²å‹è‰²è¦šï¼‰',\n      icon: <Eye className=\"w-5 h-5\" />,\n      percentage: 'ç´„92%',\n      colors: results?.original || []\n    },\n    protanomaly: {\n      name: '1å‹è‰²è¦šï¼ˆèµ¤è‰²å¼±ï¼‰',\n      description: 'LéŒä½“ï¼ˆé•·æ³¢é•·ï¼‰ã®æ„Ÿåº¦ãŒä½ä¸‹',\n      icon: <EyeOff className=\"w-5 h-5 text-red-500\" />,\n      percentage: 'ç´„1%',\n      colors: results?.protanomaly || []\n    },\n    deuteranomaly: {\n      name: '2å‹è‰²è¦šï¼ˆç·‘è‰²å¼±ï¼‰',\n      description: 'MéŒä½“ï¼ˆä¸­æ³¢é•·ï¼‰ã®æ„Ÿåº¦ãŒä½ä¸‹',\n      icon: <EyeOff className=\"w-5 h-5 text-green-500\" />,\n      percentage: 'ç´„5%',\n      colors: results?.deuteranomaly || []\n    },\n    tritanomaly: {\n      name: '3å‹è‰²è¦šï¼ˆé’è‰²å¼±ï¼‰',\n      description: 'SéŒä½“ï¼ˆçŸ­æ³¢é•·ï¼‰ã®æ„Ÿåº¦ãŒä½ä¸‹',\n      icon: <EyeOff className=\"w-5 h-5 text-blue-500\" />,\n      percentage: 'ç´„0.01%',\n      colors: results?.tritanomaly || []\n    },\n    monochromacy: {\n      name: '1è‰²å‹è‰²è¦šï¼ˆå…¨è‰²ç›²ï¼‰',\n      description: 'è‰²ç›¸ã‚’è­˜åˆ¥ã§ããªã„',\n      icon: <EyeOff className=\"w-5 h-5 text-gray-500\" />,\n      percentage: 'ç´„0.003%',\n      colors: results?.monochromacy || []\n    }\n  };\n\n  // ğŸ¨ **ãƒ‘ãƒ¬ãƒƒãƒˆè¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**\n  const PaletteView = ({ colors, label }: { colors: ColorInfo[]; label: string }) => {\n    if (colors.length === 0) return null;\n    \n    return (\n      <div className=\"space-y-3\">\n        <h4 className=\"font-medium text-gray-800\">{label}</h4>\n        <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3\">\n          {colors.map((color, index) => (\n            <div key={index} className=\"space-y-2\">\n              <div \n                className=\"w-full h-16 rounded-lg border-2 border-gray-200 shadow-sm\"\n                style={{ backgroundColor: color.hex }}\n              />\n              <div className=\"text-center\">\n                <p className=\"text-xs font-mono text-gray-600\">{color.hex}</p>\n                <p className=\"text-xs text-gray-500 truncate\">{color.name}</p>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  };\n\n  // ğŸ“Š **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢è¨ˆç®—**\n  const getAccessibilityScore = () => {\n    if (!results) return 0;\n    \n    const totalIssues = results.accessibility.issues.length;\n    const maxPossibleIssues = colors.length * (colors.length - 1) / 2; // å…¨çµ„ã¿åˆã‚ã›\n    \n    return Math.round(((maxPossibleIssues - totalIssues) / maxPossibleIssues) * 100);\n  };\n\n  if (colors.length === 0) {\n    return (\n      <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-6\">\n        <div className=\"flex items-center\">\n          <AlertTriangle className=\"w-5 h-5 text-yellow-600 mr-2\" />\n          <p className=\"text-yellow-800\">\n            è‰²è¦šå¤šæ§˜æ€§ãƒ†ã‚¹ãƒˆã«ã¯æœ€ä½1è‰²å¿…è¦ã§ã™ã€‚ãƒ‘ãƒ¬ãƒƒãƒˆã«è‰²ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"bg-white rounded-lg shadow-lg p-6\">\n        <div className=\"flex items-center justify-center py-12\">\n          <RefreshCw className=\"w-8 h-8 text-blue-600 animate-spin mr-3\" />\n          <p className=\"text-gray-600\">è‰²è¦šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œä¸­...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!results) {\n    return (\n      <div className=\"bg-red-50 border border-red-200 rounded-lg p-6\">\n        <div className=\"flex items-center\">\n          <AlertTriangle className=\"w-5 h-5 text-red-600 mr-2\" />\n          <p className=\"text-red-800\">\n            ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  const currentVisionType = visionTypes[activeView];\n  const accessibilityScore = getAccessibilityScore();\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-lg p-6\">\n      {/* ğŸ·ï¸ **ãƒ˜ãƒƒãƒ€ãƒ¼** */}\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 flex items-center\">\n          <Eye className=\"w-5 h-5 mr-2\" />\n          è‰²è¦šå¤šæ§˜æ€§ãƒ†ã‚¹ãƒˆ\n        </h3>\n        \n        {/* ğŸ“Š **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢** */}\n        <div className=\"flex items-center space-x-4\">\n          <div className=\"text-right\">\n            <p className=\"text-sm text-gray-600\">ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢</p>\n            <p className={`text-2xl font-bold ${\n              accessibilityScore >= 80 ? 'text-green-600' :\n              accessibilityScore >= 60 ? 'text-yellow-600' :\n              'text-red-600'\n            }`}>\n              {accessibilityScore}%\n            </p>\n          </div>\n          {results.accessibility.isAccessible ? (\n            <CheckCircle className=\"w-8 h-8 text-green-600\" />\n          ) : (\n            <AlertTriangle className=\"w-8 h-8 text-yellow-600\" />\n          )}\n        </div>\n      </div>\n\n      {/* ğŸ¯ **è‰²è¦šã‚¿ã‚¤ãƒ—é¸æŠ** */}\n      <div className=\"mb-6\">\n        <div className=\"flex flex-wrap gap-2\">\n          {Object.entries(visionTypes).map(([key, type]) => (\n            <button\n              key={key}\n              onClick={() => setActiveView(key as typeof activeView)}\n              className={`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${\n                activeView === key\n                  ? 'bg-blue-100 text-blue-800 border-2 border-blue-300'\n                  : 'bg-gray-100 text-gray-600 hover:bg-gray-200 border-2 border-transparent'\n              }`}\n            >\n              {type.icon}\n              <span>{type.name}</span>\n              <span className=\"text-xs opacity-75\">({type.percentage})</span>\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* ğŸ¨ **é¸æŠã•ã‚ŒãŸè‰²è¦šã‚¿ã‚¤ãƒ—ã®æƒ…å ±** */}\n      <div className=\"mb-6 p-4 bg-gray-50 rounded-lg\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <h4 className=\"font-medium text-gray-800 flex items-center\">\n            {currentVisionType.icon}\n            <span className=\"ml-2\">{currentVisionType.name}</span>\n          </h4>\n          <span className=\"text-sm text-gray-600\">äººå£ã®{currentVisionType.percentage}</span>\n        </div>\n        <p className=\"text-sm text-gray-600\">{currentVisionType.description}</p>\n      </div>\n\n      {/* ğŸ¨ **ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆè¡¨ç¤º** */}\n      {showSimulation && (\n        <div className=\"mb-6\">\n          <PaletteView \n            colors={currentVisionType.colors} \n            label={`${currentVisionType.name}ã§ã®è¦‹ãˆæ–¹`}\n          />\n        </div>\n      )}\n\n      {/* ğŸ“Š **æ¯”è¼ƒè¡¨ç¤ºï¼ˆã‚ªãƒªã‚¸ãƒŠãƒ«ã¨ã®ä¸¦åˆ—è¡¨ç¤ºï¼‰** */}\n      {activeView !== 'original' && showSimulation && (\n        <div className=\"mb-6 p-4 border rounded-lg\">\n          <h4 className=\"font-medium text-gray-800 mb-4\">æ¯”è¼ƒè¡¨ç¤º</h4>\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <PaletteView colors={results.original} label=\"ã‚ªãƒªã‚¸ãƒŠãƒ«\" />\n            <PaletteView colors={currentVisionType.colors} label={currentVisionType.name} />\n          </div>\n        </div>\n      )}\n\n      {/* âš ï¸ **å•é¡Œç‚¹ã¨ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³** */}\n      <div className=\"space-y-4\">\n        {/* ğŸš¨ **æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ** */}\n        {results.accessibility.issues.length > 0 && (\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n            <div className=\"flex items-center mb-3\">\n              <AlertTriangle className=\"w-5 h-5 text-red-600 mr-2\" />\n              <h4 className=\"font-medium text-red-800\">æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ</h4>\n            </div>\n            <ul className=\"space-y-2\">\n              {results.accessibility.issues.map((issue, index) => (\n                <li key={index} className=\"text-sm text-red-700 flex items-start\">\n                  <span className=\"mr-2\">â€¢</span>\n                  <span>{issue}</span>\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n\n        {/* ğŸ’¡ **æ”¹å–„ææ¡ˆ** */}\n        {results.accessibility.recommendations.length > 0 && (\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n            <div className=\"flex items-center mb-3\">\n              <Info className=\"w-5 h-5 text-blue-600 mr-2\" />\n              <h4 className=\"font-medium text-blue-800\">æ”¹å–„ææ¡ˆ</h4>\n            </div>\n            <ul className=\"space-y-2\">\n              {results.accessibility.recommendations.map((recommendation, index) => (\n                <li key={index} className=\"text-sm text-blue-700 flex items-start\">\n                  <span className=\"mr-2\">ğŸ’¡</span>\n                  <span>{recommendation}</span>\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n\n        {/* âœ… **è‰¯å¥½ãªå ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** */}\n        {results.accessibility.isAccessible && (\n          <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n            <div className=\"flex items-center mb-2\">\n              <CheckCircle className=\"w-5 h-5 text-green-600 mr-2\" />\n              <h4 className=\"font-medium text-green-800\">å„ªç§€ãªã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£</h4>\n            </div>\n            <p className=\"text-sm text-green-700\">\n              ã“ã®ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆã¯è‰²è¦šå¤šæ§˜æ€§ã«é…æ…®ã•ã‚Œã¦ãŠã‚Šã€å¤šãã®äººã«ã¨ã£ã¦åŒºåˆ¥ã—ã‚„ã™ã„é…è‰²ã«ãªã£ã¦ã„ã¾ã™ã€‚\n            </p>\n          </div>\n        )}\n      </div>\n\n      {/* ğŸ“š **è©³ç´°æƒ…å ±ã®è¡¨ç¤º/éè¡¨ç¤º** */}\n      <div className=\"mt-6\">\n        <button\n          onClick={() => setShowDetails(!showDetails)}\n          className=\"flex items-center text-sm text-blue-600 hover:text-blue-800 transition-colors\"\n        >\n          <Info className=\"w-4 h-4 mr-1\" />\n          {showDetails ? 'è©³ç´°æƒ…å ±ã‚’éš ã™' : 'è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º'}\n        </button>\n        \n        {showDetails && (\n          <div className=\"mt-4 p-4 bg-gray-50 rounded-lg\">\n            <h4 className=\"font-medium text-gray-800 mb-3\">è‰²è¦šå¤šæ§˜æ€§ã«ã¤ã„ã¦</h4>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600\">\n              <div>\n                <h5 className=\"font-medium text-gray-700 mb-2\">ğŸ”´ 1å‹è‰²è¦šï¼ˆãƒ—ãƒ­ã‚¿ãƒãƒãƒªãƒ¼ï¼‰</h5>\n                <ul className=\"space-y-1 ml-4\">\n                  <li>â€¢ LéŒä½“ï¼ˆé•·æ³¢é•·ãƒ»èµ¤ï¼‰ã®æ„Ÿåº¦ä½ä¸‹</li>\n                  <li>â€¢ èµ¤ã¨ç·‘ã®åŒºåˆ¥ãŒå›°é›£</li>\n                  <li>â€¢ ç”·æ€§ã®ç´„1%ã€å¥³æ€§ã®ç´„0.02%</li>\n                </ul>\n              </div>\n              \n              <div>\n                <h5 className=\"font-medium text-gray-700 mb-2\">ğŸŸ¢ 2å‹è‰²è¦šï¼ˆãƒ‡ãƒ¥ãƒ¼ã‚¿ãƒãƒãƒªãƒ¼ï¼‰</h5>\n                <ul className=\"space-y-1 ml-4\">\n                  <li>â€¢ MéŒä½“ï¼ˆä¸­æ³¢é•·ãƒ»ç·‘ï¼‰ã®æ„Ÿåº¦ä½ä¸‹</li>\n                  <li>â€¢ æœ€ã‚‚ä¸€èˆ¬çš„ãªè‰²è¦šç•°å¸¸</li>\n                  <li>â€¢ ç”·æ€§ã®ç´„5%ã€å¥³æ€§ã®ç´„0.4%</li>\n                </ul>\n              </div>\n              \n              <div>\n                <h5 className=\"font-medium text-gray-700 mb-2\">ğŸ”µ 3å‹è‰²è¦šï¼ˆãƒˆãƒªã‚¿ãƒãƒãƒªãƒ¼ï¼‰</h5>\n                <ul className=\"space-y-1 ml-4\">\n                  <li>â€¢ SéŒä½“ï¼ˆçŸ­æ³¢é•·ãƒ»é’ï¼‰ã®æ„Ÿåº¦ä½ä¸‹</li>\n                  <li>â€¢ é’ã¨é»„ã®åŒºåˆ¥ãŒå›°é›£</li>\n                  <li>â€¢ ç”·å¥³ã¨ã‚‚ç´„0.01%</li>\n                </ul>\n              </div>\n              \n              <div>\n                <h5 className=\"font-medium text-gray-700 mb-2\">âš« 1è‰²å‹è‰²è¦šï¼ˆãƒ¢ãƒã‚¯ãƒ­ãƒã‚·ãƒ¼ï¼‰</h5>\n                <ul className=\"space-y-1 ml-4\">\n                  <li>â€¢ è‰²ç›¸ã‚’å…¨ãè­˜åˆ¥ã§ããªã„</li>\n                  <li>â€¢ éå¸¸ã«ç¨€</li>\n                  <li>â€¢ ç”·å¥³ã¨ã‚‚ç´„0.003%</li>\n                </ul>\n              </div>\n            </div>\n            \n            <div className=\"mt-4 p-3 bg-blue-100 rounded\">\n              <p className=\"text-sm text-blue-800\">\n                <strong>ğŸ’¡ ãƒ‡ã‚¶ã‚¤ãƒ³ã®ãƒã‚¤ãƒ³ãƒˆ:</strong> è‰²ã ã‘ã«é ¼ã‚‰ãšã€å½¢çŠ¶ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ãƒ†ã‚­ã‚¹ãƒˆãƒ©ãƒ™ãƒ«ãªã©ã®\n                è£œåŠ©çš„ãªè¦–è¦šçš„æ‰‹ãŒã‹ã‚Šã‚’ä½µç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šå¤šãã®äººã«ã¨ã£ã¦ã‚¢ã‚¯ã‚»ã‚·ãƒ–ãƒ«ãªãƒ‡ã‚¶ã‚¤ãƒ³ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚\n              </p>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}
